from matplotlib import pyplot as plt
from statistics import mean
import pickle
import os
import numpy as np
import seaborn as sns
import math


ks = [10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120, 130, 140, 150, 160, 170, 180, 190, 200, 210, 220, 230, 240, 250, 260, 270, 280, 290, 300, 310, 320, 330, 340, 350, 360, 370, 380, 390, 400, 410, 420, 430, 440, 450, 460, 470, 480, 490, 500, 510, 520, 530, 540, 550, 560, 570, 580, 590, 600, 610, 620, 630, 640, 650, 660, 670, 680, 690, 700, 710, 720, 730, 740, 750, 760, 770, 780, 790, 800, 810, 820, 830, 840, 850, 860, 870, 880, 890, 900, 910, 920, 930, 940, 950, 960, 970, 980, 990, 1000, 1010, 1020, 1030, 1040, 1050, 1060, 1070, 1080, 1090, 1100, 1110, 1120, 1130, 1140, 1150, 1160, 1170, 1180, 1190, 1200, 1210, 1220, 1230, 1240, 1250, 1260, 1270, 1280, 1290, 1300, 1310, 1320, 1330, 1340, 1350, 1360, 1370, 1380, 1390, 1400, 1410, 1420, 1430, 1440, 1450, 1460, 1470, 1480, 1490, 1500, 1510, 1520, 1530, 1540, 1550, 1560, 1570, 1580, 1590, 1600, 1610, 1620, 1630, 1640, 1650, 1660, 1670, 1680, 1690, 1700, 1710, 1720, 1730, 1740, 1750, 1760, 1770, 1780, 1790, 1800, 1810, 1820, 1830, 1840, 1850, 1860, 1870, 1880, 1890, 1900, 1910, 1920, 1930, 1940, 1950, 1960, 1970, 1980, 1990, 2000, 2010, 2020, 2030, 2040, 2050, 2060, 2070, 2080, 2090, 2100, 2110, 2120, 2130, 2140, 2150, 2160, 2170, 2180, 2190, 2200, 2210, 2220, 2230, 2240, 2250, 2260, 2270, 2280, 2290, 2300, 2310, 2320, 2330, 2340, 2350, 2360, 2370, 2380, 2390, 2400, 2410, 2420, 2430, 2440, 2450, 2460, 2470, 2480, 2490, 2500, 2510, 2520, 2530, 2540, 2550, 2560, 2570, 2580, 2590, 2600, 2610, 2620, 2630, 2640, 2650, 2660, 2670, 2680, 2690, 2700, 2710, 2720, 2730, 2740, 2750, 2760, 2770, 2780, 2790, 2800, 2810, 2820, 2830, 2840, 2850, 2860, 2870, 2880, 2890, 2900, 2910, 2920, 2930, 2940, 2950, 2960, 2970, 2980, 2990, 3000]
mse_ge2e = [0.09447755868086279, 0.08395318129814239, 0.07769923289200628, 0.0739265470853984, 0.07183091474780749, 0.07032198207618004, 0.06924919047535333, 0.06820014133681535, 0.06709600984304949, 0.06610255003707283, 0.06499210932333073, 0.06413843573526537, 0.06341155999086753, 0.06278422513408247, 0.06221011828764935, 0.06178302477147044, 0.06141468166634321, 0.061121135006777454, 0.06079066387500796, 0.060572376680936214, 0.06042157432154252, 0.060300302670573167, 0.06014829068358772, 0.06004259784643943, 0.05998180587014688, 0.059905534524156465, 0.05985214076514573, 0.05982953063676131, 0.0598243903115694, 0.05980340444036213, 0.0597704316570608, 0.05976867705940906, 0.05981807779575775, 0.059817608235697484, 0.059811266692273844, 0.0598121625538867, 0.05984261261468649, 0.05985641287437974, 0.05988588001646272, 0.05993032162157404, 0.05998336256011594, 0.06004130125869684, 0.060093690050432344, 0.060122145755350194, 0.06014803639700994, 0.06020456019825254, 0.06023454050473599, 0.06027941005554301, 0.06031698912155812, 0.0603457729186041, 0.060377505591760416, 0.06042808779217458, 0.060474836580183655, 0.06051216260505906, 0.06054523954883861, 0.060595787875208, 0.060637312114235974, 0.060688265707957045, 0.06073269917614284, 0.060759871404855725, 0.06080073116853662, 0.060846372174607595, 0.060880538247581474, 0.060921273712932274, 0.06098319628281395, 0.06103615814293163, 0.061095136359434234, 0.0611462675935827, 0.06120039748772008, 0.061230952252759804, 0.061283097106070404, 0.061345253833580075, 0.061383957621714724, 0.06142314680837478, 0.06145915469296062, 0.061506847822714254, 0.06156059405316219, 0.061604208969742766, 0.061641377699982715, 0.06168840870646647, 0.061722204297131676, 0.06175689479375673, 0.06179457398253959, 0.061838632746837874, 0.06188623668820359, 0.061921364553896685, 0.06196414918348691, 0.06200540659176921, 0.06205573355188499, 0.06208262320850336, 0.06212437357963877, 0.06215544367892143, 0.062190394209414544, 0.062229934567704835, 0.06227696201970701, 0.062321761199047365, 0.06236011824148258, 0.062389516831007, 0.06242680790311428, 0.06245852515979149, 0.06249823888934356, 0.06253401723848609, 0.06257062966940011, 0.0626036927093392, 0.0626387415727982, 0.06268111780063959, 0.0627112655102332, 0.0627541707831142, 0.06279159470699576, 0.06282967314060926, 0.06287272023865469, 0.06290663973380574, 0.06294670044370841, 0.06298181585807018, 0.06302499662834599, 0.06305856177988226, 0.06309199682230393, 0.06312017710285894, 0.06315925948182907, 0.06319016337103514, 0.06322420653717443, 0.06326175651999846, 0.06329807530326995, 0.06333249094040738, 0.06336747470909375, 0.06339718257998876, 0.06343318648767937, 0.06345681492166765, 0.06348982857120126, 0.06352963924975767, 0.06356564718837503, 0.0635995340152855, 0.06363858938930832, 0.06368114571271973, 0.06371104687252178, 0.06374540668816285, 0.06377594595025927, 0.06380779986610383, 0.06383655786277569, 0.06387013166207364, 0.06390024364050936, 0.06393151099091474, 0.0639722539190429, 0.06401513744531222, 0.0640459842977577, 0.06407358469399094, 0.06410301726351722, 0.06412901343587679, 0.06416698820312144, 0.06419932711875041, 0.06424075252591638, 0.06427117301970062, 0.0642990572757991, 0.06432733183742383, 0.0643602199597247, 0.06439086196014988, 0.06441764045461913, 0.06445446211664567, 0.06448437382948767, 0.06451846402996153, 0.06454735728821168, 0.06458107584827666, 0.0646140438948495, 0.06464565318895793, 0.06468068768694685, 0.06472048591591527, 0.06474512641332078, 0.064780246041171, 0.06481402207166681, 0.06485230572049505, 0.06488367102809708, 0.06491192499888505, 0.0649387522701914, 0.06496566386883972, 0.0649971988495371, 0.06502667502180619, 0.06505088407821051, 0.06507979815796464, 0.06510726021001936, 0.06512755481484937, 0.06515780553649343, 0.06518516363158813, 0.06521467183022589, 0.0652464028907558, 0.06527653788648405, 0.06530542755736946, 0.06533856966415727, 0.06536803379029961, 0.06539205506215728, 0.06542024805950324, 0.06545550173584745, 0.06548375322219663, 0.06551745996373275, 0.06554670055228587, 0.06558086680728724, 0.06561012037396682, 0.06563979448428886, 0.065669116427405, 0.06569636486614072, 0.06572400521591762, 0.06575452183432641, 0.0657871522196296, 0.0658175757930247, 0.06584520408501825, 0.06587911198420461, 0.06590768966311449, 0.06593914091148155, 0.0659659242226512, 0.06599528190724652, 0.06602221115629961, 0.06605107962708652, 0.06608324281999296, 0.06610834284486544, 0.06614055846957767, 0.06616636958915023, 0.06619637115494996, 0.0662233406247368, 0.06625029976502742, 0.06628027093373003, 0.06630918297482535, 0.06633403954163362, 0.06636819754034973, 0.06639912951480875, 0.066429134970706, 0.06645648112510108, 0.06649110836762569, 0.06651934621131003, 0.06654928795913499, 0.06657559643945024, 0.06660984784723072, 0.06663747247082868, 0.06666906532746986, 0.06670092087278645, 0.06673092887346482, 0.06675927370987304, 0.06678881427712599, 0.06681949774048061, 0.06684795937488569, 0.0668832095368946, 0.06691160480475417, 0.0669406331918421, 0.066967385635439, 0.06699548371454214, 0.06702625789443337, 0.06705658002811973, 0.06708754605934805, 0.06711753270990606, 0.06714689758699334, 0.06717794515678516, 0.06720699959576872, 0.06724059260491362, 0.06727125289990749, 0.06730167155297238, 0.0673330496210481, 0.06736171283455648, 0.0673955898927131, 0.06742782005779831, 0.06745601179681483, 0.06748369515177835, 0.06751274947223009, 0.06754317663720295, 0.0675689829684477, 0.06760761402977636, 0.06763806926507387, 0.06767042060900227, 0.06770615226107649, 0.06773311257146274, 0.06775871097524233, 0.06779191429967557, 0.06781829819895942, 0.06784794336493802, 0.06787775188182414, 0.06790643170692214, 0.06793934550941996, 0.06797017563714872, 0.06799803315901767, 0.06802869991666495, 0.06805947341395395, 0.06809017910140576, 0.06811512205407136, 0.06814595937671854, 0.0681761462340472, 0.06820837877578086, 0.06823761327163705, 0.06826654460952242, 0.06829812595497337, 0.06832905047548558, 0.06836506944622442, 0.06839351185247332, 0.06842587125792675, 0.06846101383018377, 0.06848928895157418, 0.06851971451046018, 0.06854797890658765, 0.06857809695578494, 0.06860797509465785, 0.06863615141952874, 0.06866673910201435, 0.06869416502949023, 0.06872605363325246]
mse_trill = [0.08801527385481062, 0.08129925015095188, 0.07782893942825767, 0.07611239393822022, 0.07465692051701012, 0.07377600857247384, 0.07294212342182478, 0.07220843709507997, 0.07176711472089115, 0.07154744564880425, 0.07126654017299962, 0.07105557472239174, 0.07084400325119339, 0.07065657008919632, 0.07057132699822519, 0.07053531012273437, 0.07046970620750574, 0.07038960650505183, 0.07036207212266984, 0.070328650101454, 0.07033010221896716, 0.07031750677985356, 0.07028872360055244, 0.07029869820174395, 0.07030656819411475, 0.07031074535211586, 0.0703238278004513, 0.07032735995254578, 0.07029659005844117, 0.07025827869681484, 0.0702550148221671, 0.07024053408119173, 0.07023048338732296, 0.0701996157924485, 0.07021357920052407, 0.07022905074049318, 0.07019998831898466, 0.07016529740924665, 0.07014531523694693, 0.07013473062515785, 0.07012670474212462, 0.07012588041997335, 0.0700985024774961, 0.07011173922912392, 0.07010386583735195, 0.07010100977330858, 0.07010850079924208, 0.07009797305598149, 0.07009777695359977, 0.07009820864872374, 0.07010334736013177, 0.07010947332164899, 0.07011506630087153, 0.07015088866611968, 0.07014547374084885, 0.07013033622222427, 0.07012194885283914, 0.07012460928427365, 0.07013310572715013, 0.07014110679106525, 0.07014377659495494, 0.07016377523219676, 0.07017146053275229, 0.07018838156182068, 0.07018539167709574, 0.07019265919070022, 0.070200799813161, 0.07021605458025137, 0.07023331668744565, 0.07025756345308792, 0.07026049404243731, 0.07027506718348289, 0.07028963745310131, 0.07029797513462882, 0.07031396981181459, 0.07033383588116073, 0.07034843260248841, 0.07035908320101072, 0.07036715705437506, 0.07037626345725073, 0.07038945339943077, 0.07040138910963824, 0.0704186581119749, 0.070440235403364, 0.07043916958776313, 0.07045797617249373, 0.07046691547367978, 0.07048045540630345, 0.07048270984245045, 0.07049111265915799, 0.07050395416182596, 0.07051948898509444, 0.07053936331630772, 0.0705614855332103, 0.07057658800080134, 0.07057537315709497, 0.07058501210288214, 0.07060337544895003, 0.07060180083797733, 0.07062069946807963]
min_mse_ge2e = min(mse_ge2e)
min_mse_trill = min(mse_trill)


plt.figure(figsize=(12, 7))
sns.set_style("darkgrid")
plt.plot(ks[:100], mse_ge2e[:100], label='GE2E', color='mediumseagreen')
plt.plot(mse_ge2e.index(min_mse_ge2e)*10, min_mse_ge2e, marker='o', color='mediumseagreen')
plt.text(mse_ge2e.index(min_mse_ge2e)*10, min_mse_ge2e + 0.001, f'{min_mse_ge2e:.4f}')
plt.plot(ks[:100], mse_trill[:100], label='TRILL avg.', color='tomato')
plt.plot(mse_trill.index(min_mse_trill)*10, min_mse_trill, marker='o', color='tomato')
plt.text(mse_trill.index(min_mse_trill)*10, min_mse_trill + 0.001, f'{min_mse_trill:.4f}')
plt.axhline(y=0.0627, color='red', linestyle='--')
plt.text(750, 0.0632, f"true 'always guess 0.5' baseline", color='red', fontsize=8)
plt.title(f"Mean squared error for different k's using kNN regression")
plt.xlabel('k')
plt.ylabel('mean squared error')
plt.legend(loc='upper left')
plt.savefig(f'../graphics/plots/knn-ks.png', dpi=300)
plt.close()
